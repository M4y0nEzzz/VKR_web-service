{% extends 'base.html' %}

{% block content %}
  <h1>Список мероприятий</h1>

  <!-- Кнопка для создания нового мероприятия -->
  <div class="create-event-section">
    <a href="{% url 'create_event' %}" class="create-event-btn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: middle;">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="12" y1="18" x2="12" y2="12"></line>
        <line x1="9" y1="15" x2="15" y2="15"></line>
      </svg>
      Создать мероприятие
    </a>
  </div>

  <!-- Фильтрация -->
  <form method="GET" action="{% url 'events_ui' %}">
  <div class="filter-group">
    <label for="month">Месяц (1-12):</label>
    <input type="number" name="month" id="month"
           value="{{ month|default:'' }}"
           min="1" max="12"
           placeholder="Месяц (1-12)">
  </div>
  <div class="filter-group">
    <label for="year">Год:</label>
    <input type="number" name="year" id="year"
           value="{{ year|default:current_year }}"
           min="2000" max="2100"
           placeholder="Год">
  </div>
  <div class="filter-group">
    <label for="sort_order">Сортировка:</label>
    <select name="sort_order" id="sort_order">
      <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>По убыванию</option>
      <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>По возрастанию</option>
    </select>
  </div>

  <button type="submit" class="filter-btn">Фильтровать</button>

  {% if month or year %}
    <a href="{% url 'events_ui' %}" class="clear-filters">Сбросить фильтры</a>
  {% endif %}
</form>

<!-- Массовые действия -->
<div class="bulk-actions">
    <button type="button" class="export-btn" id="exportBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Экспортировать выбранные
    </button>

    <button type="button" class="delete-btn" id="deleteBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
        Удалить выбранные
    </button>

    <div class="selection-controls">
        <button type="button" class="select-all-btn" id="selectAllBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <span id="selectAllText">Выбрать все</span>
        </button>

        <span class="selected-count" id="selectedCount">Выбрано: 0</span>
    </div>
</div>



<div class="events-list">
    {% for event in page_obj %}
    <div class="event-card">
        <div class="event-header">
            <div class="event-title-section">
                <h3 class="event-title">{{ event.name }}</h3>
                <p class="event-date">{{ event.date|date:"d.m.Y H:i" }} — {{ event.end_date|date:"d.m.Y H:i" }}</p>
            </div>
            <div class="event-actions">
                <a href="{% url 'edit_event' event.id %}" class="edit-icon" title="Редактировать мероприятие">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1abc9c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </a>
            </div>
        </div>

        <div class="event-details-grid">
            <div class="detail-item">
                <div class="detail-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                    </svg>
                </div>
                <div class="detail-content">
                    <span class="detail-label">Категория:</span>
                    <span class="detail-value">{{ event.category.name|default:"—" }}</span>
                </div>
            </div>

            <div class="detail-item">
                <div class="detail-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                </div>
                <div class="detail-content">
                    <span class="detail-label">Подразделение:</span>
                    <span class="detail-value">{{ event.department.name|default:"—" }}</span>
                </div>
            </div>

            <div class="detail-item">
                <div class="detail-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#2ecc71" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <div class="detail-content">
                    <span class="detail-label">Ответственные:</span>
                    <span class="detail-value">
                        {% if event.responsible_list %}
                        {{ event.responsible_list|join:", " }}
                        {% else %}
                        Нет ответственных
                        {% endif %}
                    </span>
                </div>
            </div>

            <div class="detail-item">
                <div class="detail-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f39c12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                </div>
                <div class="detail-content">
                    <span class="detail-label">Место:</span>
                    <span class="detail-value">{{ event.place|default:"—" }}</span>
                </div>
            </div>

            <div class="detail-item full-width">
                <div class="detail-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9b59b6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                    </svg>
                </div>
                <div class="detail-content">
                    <span class="detail-label">Комментарий:</span>
                    <span class="detail-value">{{ event.comment|default:"Нет комментария" }}</span>
                </div>
            </div>
        </div>

        <div class="event-footer">
            <div class="checkbox-container">
                <input type="checkbox" name="selected_events" value="{{ event.id }}" id="event-{{ event.id }}" class="event-checkbox" data-event-name="{{ event.name }}">
                <label for="event-{{ event.id }}" class="checkbox-label">
                    <span class="checkmark"></span>
                    <span class="label-text">Выбрать мероприятие</span>
                </label>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#95a5a6" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <p>Нет мероприятий для отображения</p>
    </div>
    {% endfor %}
</div>











  <!-- Модальное окно подтверждения удаления -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Подтверждение удаления</h3>
        <button type="button" class="close-modal" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p id="deleteMessage">Вы уверены, что хотите удалить выбранные мероприятия?</p>
        <div id="eventsToDelete" class="events-list-delete" style="display: none;">
          <h4>Будут удалены следующие мероприятия:</h4>
          <ul id="deleteEventsList"></ul>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Отмена</button>
        <button type="button" class="btn btn-danger" onclick="deleteSelectedEvents()">Удалить</button>
      </div>
    </div>
  </div>

  <div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if month %}&month={{ month }}{% endif %}{% if year %}&year={{ year }}{% endif %}{% if sort_order %}&sort_order={{ sort_order }}{% endif %}">&laquo; первая</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if month %}&month={{ month }}{% endif %}{% if year %}&year={{ year }}{% endif %}{% if sort_order %}&sort_order={{ sort_order }}{% endif %}">предыдущая</a>
        {% endif %}

        <span class="current">
            Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if month %}&month={{ month }}{% endif %}{% if year %}&year={{ year }}{% endif %}{% if sort_order %}&sort_order={{ sort_order }}{% endif %}">следующая</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if month %}&month={{ month }}{% endif %}{% if year %}&year={{ year }}{% endif %}{% if sort_order %}&sort_order={{ sort_order }}{% endif %}">последняя &raquo;</a>
        {% endif %}
    </span>
</div>


<script>
// Переменные для управления выбором
let isSelectAll = false;

// Переключение выбора всех мероприятий
function toggleSelectAll() {
    const checkboxes = document.querySelectorAll('.event-checkbox');

    // Если ничего не выбрано или выбраны не все - выбираем все
    const shouldSelectAll = !isSelectAll;

    checkboxes.forEach(checkbox => {
        checkbox.checked = shouldSelectAll;
    });

    isSelectAll = shouldSelectAll;
    updateSelectedCount();
}

// Обновление счетчика выбранных мероприятий
function updateSelectedCount() {
    const checkboxes = document.querySelectorAll('.event-checkbox');
    const checkedCheckboxes = document.querySelectorAll('.event-checkbox:checked');
    const count = checkedCheckboxes.length;
    const totalCheckboxes = checkboxes.length;

    document.getElementById('selectedCount').textContent = `Выбрано: ${count}`;

    // Обновляем флаг isSelectAll
    isSelectAll = count > 0 && count === totalCheckboxes;

    // Обновляем текст кнопки "Выбрать все"
    document.getElementById('selectAllText').textContent =
        isSelectAll ? 'Снять выделение' : 'Выбрать все';

    // Обновляем состояние кнопок массовых действий
    updateBulkActionsState(count);

    // Обновляем визуальное состояние кастомных чекбоксов
    updateCustomCheckboxes();
}

// Обновление визуального состояния кастомных чекбоксов
function updateCustomCheckboxes() {
    const checkboxes = document.querySelectorAll('.event-checkbox');
    checkboxes.forEach(checkbox => {
        const label = checkbox.nextElementSibling;
        if (label && label.classList.contains('checkbox-label')) {
            const checkmark = label.querySelector('.checkmark');
            const labelText = label.querySelector('.label-text');

            if (checkbox.checked) {
                if (checkmark) {
                    checkmark.style.backgroundColor = '#e74c3c';
                    checkmark.style.borderColor = '#e74c3c';
                }
                if (labelText) {
                    labelText.style.color = '#e74c3c';
                    labelText.style.fontWeight = '600';
                }
            } else {
                if (checkmark) {
                    checkmark.style.backgroundColor = '';
                    checkmark.style.borderColor = '#95a5a6';
                }
                if (labelText) {
                    labelText.style.color = '#bdc3c7';
                    labelText.style.fontWeight = '';
                }
            }
        }
    });
}

// Обновление состояния кнопок массовых действий
function updateBulkActionsState(selectedCount) {
    const exportBtn = document.querySelector('.export-btn');
    const deleteBtn = document.querySelector('.delete-btn');

    const hasSelection = selectedCount > 0;

    exportBtn.disabled = !hasSelection;
    deleteBtn.disabled = !hasSelection;

    if (!hasSelection) {
        exportBtn.style.opacity = '0.6';
        exportBtn.style.cursor = 'not-allowed';
        deleteBtn.style.opacity = '0.6';
        deleteBtn.style.cursor = 'not-allowed';
    } else {
        exportBtn.style.opacity = '1';
        exportBtn.style.cursor = 'pointer';
        deleteBtn.style.opacity = '1';
        deleteBtn.style.cursor = 'pointer';
    }
}

// Показ модального окна подтверждения удаления
function showDeleteConfirm() {
    const checkboxes = document.querySelectorAll('.event-checkbox:checked');

    if (checkboxes.length === 0) {
        alert('Пожалуйста, выберите хотя бы одно мероприятие для удаления');
        return;
    }

    const deleteMessage = document.getElementById('deleteMessage');
    const eventsList = document.getElementById('deleteEventsList');
    const eventsToDelete = document.getElementById('eventsToDelete');

    eventsList.innerHTML = '';

    if (checkboxes.length === 1) {
        const eventName = checkboxes[0].dataset.eventName;
        deleteMessage.textContent = `Вы уверены, что хотите удалить мероприятие "${eventName}"?`;
        eventsToDelete.style.display = 'none';
    } else {
        deleteMessage.textContent = `Вы уверены, что хотите удалить ${checkboxes.length} мероприятий?`;
        eventsToDelete.style.display = 'block';

        // Ограничиваем показ до 10 мероприятий для читаемости
        const maxShown = 10;

        checkboxes.forEach((checkbox, index) => {
            if (index < maxShown) {
                const li = document.createElement('li');
                li.textContent = checkbox.dataset.eventName;
                eventsList.appendChild(li);
            }
        });

        // Показываем сколько еще мероприятий не отображается
        if (checkboxes.length > maxShown) {
            const li = document.createElement('li');
            li.textContent = `... и еще ${checkboxes.length - maxShown} мероприятий`;
            li.style.color = '#bdc3c7';
            li.style.fontStyle = 'italic';
            eventsList.appendChild(li);
        }
    }

    document.getElementById('deleteModal').style.display = 'block';
}

// Закрытие модального окна удаления
function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

// Удаление выбранных мероприятий
function deleteSelectedEvents() {
    const checkboxes = document.querySelectorAll('.event-checkbox:checked');
    const eventIds = Array.from(checkboxes).map(checkbox => checkbox.value);

    // Показываем индикатор загрузки
    const deleteBtn = document.querySelector('.delete-btn');
    const originalText = deleteBtn.innerHTML;
    deleteBtn.innerHTML = '<svg class="spinner" width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/><path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="4" fill="none" stroke-linecap="round"/></svg> Удаление...';
    deleteBtn.disabled = true;

    // Создаем скрытую форму для отправки данных
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = "{% url 'bulk_delete_events' %}";

    const csrfToken = document.createElement('input');
    csrfToken.type = 'hidden';
    csrfToken.name = 'csrfmiddlewaretoken';
    csrfToken.value = '{{ csrf_token }}';
    form.appendChild(csrfToken);

    eventIds.forEach(id => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'selected_events';
        input.value = id;
        form.appendChild(input);
    });

    document.body.appendChild(form);
    form.submit();
}

// Экспорт выбранных мероприятий
function exportSelectedEvents(e) {
    e.preventDefault();

    const checkboxes = document.querySelectorAll('.event-checkbox:checked');
    if (checkboxes.length === 0) {
        alert('Пожалуйста, выберите хотя бы одно мероприятие для экспорта');
        return;
    }

    // Показываем индикатор загрузки
    const exportBtn = document.querySelector('.export-btn');
    const originalText = exportBtn.innerHTML;
    exportBtn.innerHTML = '<svg class="spinner" width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/><path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="4" fill="none" stroke-linecap="round"/></svg> Экспорт...';
    exportBtn.disabled = true;

    // Создаем скрытую форму для отправки данных
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = "{% url 'export_selected_events' %}";
    form.style.display = 'none';

    const csrfToken = document.createElement('input');
    csrfToken.type = 'hidden';
    csrfToken.name = 'csrfmiddlewaretoken';
    csrfToken.value = '{{ csrf_token }}';
    form.appendChild(csrfToken);

    checkboxes.forEach(checkbox => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'selected_events';
        input.value = checkbox.value;
        form.appendChild(input);
    });

    // Создаем iframe для скачивания файла
    const iframe = document.createElement('iframe');
    iframe.name = 'downloadFrame';
    iframe.style.display = 'none';
    document.body.appendChild(iframe);

    form.target = 'downloadFrame';

    document.body.appendChild(form);
    form.submit();

    // Восстанавливаем кнопку через 2 секунды
    setTimeout(() => {
        exportBtn.innerHTML = originalText;
        exportBtn.disabled = false;
        updateBulkActionsState(checkboxes.length);
    }, 2000);

    // Убираем форму и iframe после отправки
    setTimeout(() => {
        if (form.parentNode) form.parentNode.removeChild(form);
        if (iframe.parentNode) iframe.parentNode.removeChild(iframe);
    }, 3000);
}

// Закрытие модального окна при клике вне его
window.addEventListener('click', (event) => {
    const modal = document.getElementById('deleteModal');
    if (event.target === modal) {
        closeDeleteModal();
    }
});

// Закрытие модального окна при нажатии Escape
document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
        closeDeleteModal();
    }
});

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    // Добавляем обработчики изменения для всех чекбоксов
    const checkboxes = document.querySelectorAll('.event-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateSelectedCount);
    });

    // Инициализируем счетчик и состояние чекбоксов
    updateSelectedCount();

    // Назначаем обработчики для кнопок
    const exportBtn = document.querySelector('.export-btn');
    const deleteBtn = document.querySelector('.delete-btn');
    const selectAllBtn = document.querySelector('.select-all-btn');

    if (exportBtn) exportBtn.addEventListener('click', exportSelectedEvents);
    if (deleteBtn) deleteBtn.addEventListener('click', showDeleteConfirm);
    if (selectAllBtn) selectAllBtn.addEventListener('click', toggleSelectAll);

    const closeModalBtn = document.querySelector('.close-modal');
    const confirmDeleteBtn = document.querySelector('.btn-danger');
    const cancelDeleteBtn = document.querySelector('.btn-secondary');

    if (closeModalBtn) closeModalBtn.addEventListener('click', closeDeleteModal);
    if (confirmDeleteBtn) confirmDeleteBtn.addEventListener('click', deleteSelectedEvents);
    if (cancelDeleteBtn) cancelDeleteBtn.addEventListener('click', closeDeleteModal);

    // Добавляем стиль для спиннера
    const style = document.createElement('style');
    style.textContent = `
        .spinner {
            animation: rotate 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .export-btn:disabled:hover,
        .delete-btn:disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        .event-checkbox {
            position: absolute;
            opacity: 0;
            width: 20px;
            height: 20px;
            cursor: pointer;
            z-index: 1;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: #bdc3c7;
            transition: color 0.3s ease;
            position: relative;
        }

        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid #95a5a6;
            border-radius: 4px;
            margin-right: 10px;
            position: relative;
            transition: all 0.3s ease;
        }

        .checkmark::after {
            content: '';
            position: absolute;
            display: none;
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid #fff;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .event-checkbox:checked + .checkbox-label .checkmark {
            background-color: #e74c3c;
            border-color: #e74c3c;
        }

        .event-checkbox:checked + .checkbox-label .checkmark::after {
            display: block;
        }

        .event-checkbox:checked + .checkbox-label .label-text {
            color: #e74c3c;
            font-weight: 600;
        }
    `;
    document.head.appendChild(style);

    // Отладочная информация (можно удалить после тестирования)
    console.log('Скрипт инициализирован. Найдено чекбоксов:', checkboxes.length);
});

// Вспомогательная функция для отладки
function debugSelection() {
    const checkboxes = document.querySelectorAll('.event-checkbox');
    const checked = document.querySelectorAll('.event-checkbox:checked');
    console.log('Всего чекбоксов:', checkboxes.length);
    console.log('Выбрано чекбоксов:', checked.length);
    console.log('Состояние isSelectAll:', isSelectAll);

    // Показываем состояние каждого чекбокса
    checkboxes.forEach((checkbox, index) => {
        console.log(`Чекбокс ${index}:`, {
            id: checkbox.id,
            checked: checkbox.checked,
            value: checkbox.value
        });
    });
}
</script>


  <style>
  /* Стили для кнопки создания мероприятия */
  .create-event-section {
    margin-bottom: 30px;
  }

  .create-event-btn {
    display: inline-flex;
    align-items: center;
    padding: 14px 28px;
    background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
    color: white;
    text-decoration: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
  }

  .create-event-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(26, 188, 156, 0.4);
    color: white;
    text-decoration: none;
  }

  .create-event-btn svg {
    stroke: white;
  }

  /* Стили для массовых действий */
  .bulk-actions {
    margin: 20px 0;
    padding: 20px;
    background: linear-gradient(145deg, #2c3e50, #34495e);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 15px;
    border: 1px solid #4a5f7a;
  }

  .export-btn, .delete-btn, .select-all-btn {
    display: inline-flex;
    align-items: center;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    font-family: inherit;
  }

  .export-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .export-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  }

  .delete-btn {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
  }

  .delete-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
  }

  .select-all-btn {
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
  }

  .select-all-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
  }

  .selection-controls {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .selected-count {
    color: #ecf0f1;
    font-size: 14px;
    font-weight: 600;
    background: rgba(26, 188, 156, 0.1);
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid rgba(26, 188, 156, 0.3);
  }

  /* Стили для фильтрации */
  form[action*="events_ui"] {
    background: linear-gradient(145deg, #2c3e50, #34495e);
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 25px;
    border: 1px solid #4a5f7a;
  }

  form[action*="events_ui"] label {
    color: #ecf0f1;
    font-weight: 600;
    margin-right: 12px;
    margin-bottom: 8px;
    display: inline-block;
  }

  form[action*="events_ui"] input,
  form[action*="events_ui"] select {
    padding: 10px 14px;
    border-radius: 6px;
    border: 1px solid #4a5f7a;
    background: #1a2530;
    color: #ecf0f1;
    margin-right: 15px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
  }

  form[action*="events_ui"] input:focus,
  form[action*="events_ui"] select:focus {
    outline: none;
    border-color: #1abc9c;
    box-shadow: 0 0 0 3px rgba(26, 188, 156, 0.2);
  }

  form[action*="events_ui"] button[type="submit"] {
    padding: 12px 24px;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  form[action*="events_ui"] button[type="submit"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
  }

  /* Стили для модального окна удаления */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    animation: fadeIn 0.3s ease-out;
  }

  .modal-content {
    background: linear-gradient(145deg, #2c3e50, #34495e);
    margin: 10% auto;
    padding: 0;
    border-radius: 16px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    border: 1px solid #4a5f7a;
    overflow: hidden;
  }

  .modal-header {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header h3 {
    margin: 0;
    color: white;
    font-weight: 600;
    font-size: 20px;
  }

  .close-modal {
    background: none;
    border: none;
    color: white;
    font-size: 28px;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
  }

  .close-modal:hover {
    transform: scale(1.2);
  }

  .modal-body {
    padding: 30px;
    color: #ecf0f1;
  }

  .modal-body p {
    margin: 0 0 20px 0;
    font-size: 16px;
    line-height: 1.5;
  }

  .events-list-delete {
    margin-top: 20px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .events-list-delete h4 {
    margin: 0 0 10px 0;
    color: #ecf0f1;
    font-size: 16px;
    font-weight: 600;
  }

  .events-list-delete ul {
    margin: 0;
    padding-left: 20px;
    max-height: 200px;
    overflow-y: auto;
  }

  .events-list-delete li {
    margin: 5px 0;
    color: #bdc3c7;
    font-size: 14px;
    padding: 5px 0;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
  }

  .events-list-delete li:last-child {
    border-bottom: none;
  }

  .modal-footer {
    padding: 20px;
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    border-top: 1px solid #4a5f7a;
    background: rgba(255, 255, 255, 0.05);
  }

  .modal-footer .btn {
    min-width: 120px;
  }

  /* Анимации */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Стили для событий */
  .events-list {
    display: flex;
    flex-direction: column;
    gap: 25px;
    margin-top: 20px;
  }

  .event-card {
    background: linear-gradient(145deg, #2c3e50, #34495e);
    color: white;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    padding: 25px;
    width: 100%;
    box-sizing: border-box;
    border: 1px solid #4a5f7a;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .event-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom, #1abc9c, #3498db);
  }

  .event-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 20px rgba(0, 0, 0, 0.25);
    border-color: #1abc9c;
  }

  .event-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #4a5f7a;
  }

  .event-title-section {
    flex: 1;
    padding-right: 50px;
  }

  .event-title {
    margin: 0;
    font-size: 20px;
    color: #fff;
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: 5px;
  }

  .event-date {
    font-size: 14px;
    color: #95a5a6;
    margin: 0;
    font-weight: 500;
  }

  .event-actions {
    position: absolute;
    top: 25px;
    right: 25px;
  }

  .edit-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(26, 188, 156, 0.15);
    transition: all 0.3s ease;
    border: 2px solid rgba(26, 188, 156, 0.3);
  }

  .edit-icon:hover {
    background: rgba(26, 188, 156, 0.3);
    border-color: #1abc9c;
    transform: scale(1.1) rotate(5deg);
  }

  .edit-icon svg {
    transition: all 0.3s ease;
  }

  .edit-icon:hover svg {
    stroke: #fff;
    transform: scale(1.1);
  }

  .event-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }

  .detail-item {
    display: flex;
    align-items: flex-start;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.2s ease;
  }

  .detail-item:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(26, 188, 156, 0.3);
  }

  .detail-item.full-width {
    grid-column: 1 / -1;
  }

  .detail-icon {
    margin-right: 12px;
    padding-top: 2px;
    flex-shrink: 0;
  }

  .detail-content {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-width: 0;
  }

  .detail-label {
    font-size: 12px;
    color: #95a5a6;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
  }

  .detail-value {
    font-size: 14px;
    color: #ecf0f1;
    line-height: 1.4;
    word-break: break-word;
  }

  .event-footer {
    padding-top: 20px;
    border-top: 1px solid #4a5f7a;
  }

  .checkbox-container {
    display: flex;
    align-items: center;
    cursor: pointer;
  }

  .event-checkbox {
    display: none;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
    color: #bdc3c7;
    transition: color 0.3s ease;
  }

  .checkbox-label:hover {
    color: #1abc9c;
  }

  .checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid #95a5a6;
    border-radius: 4px;
    margin-right: 10px;
    position: relative;
    transition: all 0.3s ease;
  }

  .checkmark::after {
    content: '';
    position: absolute;
    display: none;
    left: 6px;
    top: 2px;
    width: 5px;
    height: 10px;
    border: solid #fff;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }

  .event-checkbox:checked + .checkbox-label .checkmark {
    background-color: #e74c3c;
    border-color: #e74c3c;
  }

  .event-checkbox:checked + .checkbox-label .checkmark::after {
    display: block;
  }

  .event-checkbox:checked + .checkbox-label .label-text {
    color: #e74c3c;
    font-weight: 600;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border: 2px dashed #4a5f7a;
  }

  .empty-state svg {
    margin-bottom: 20px;
  }

  .empty-state p {
    color: #95a5a6;
    font-size: 18px;
    margin: 0;
  }

  .pagination {
    text-align: center;
    margin-top: 40px;
    padding: 20px 0;
  }

  .step-links a {
    display: inline-flex;
    align-items: center;
    padding: 8px 16px;
    margin: 0 5px;
    background: #2c3e50;
    color: #ecf0f1;
    text-decoration: none;
    border-radius: 6px;
    border: 1px solid #4a5f7a;
    transition: all 0.3s ease;
  }

  .step-links a:hover {
    background: #34495e;
    color: #1abc9c;
    border-color: #1abc9c;
    transform: translateY(-1px);
  }

  .current {
    font-weight: 600;
    color: #ecf0f1;
    margin: 0 15px;
    padding: 8px 16px;
    background: rgba(26, 188, 156, 0.1);
    border-radius: 6px;
  }

  /* Адаптивность */
  @media (max-width: 768px) {
    .bulk-actions {
      flex-direction: column;
      align-items: stretch;
    }

    .export-btn, .delete-btn, .select-all-btn {
      width: 100%;
      justify-content: center;
    }

    .selection-controls {
      justify-content: space-between;
      width: 100%;
    }

    .event-details-grid {
      grid-template-columns: 1fr;
    }

    .event-header {
      flex-direction: column;
    }

    .event-title-section {
      padding-right: 0;
      margin-bottom: 15px;
    }

    .event-actions {
      position: static;
      align-self: flex-end;
    }

    .modal-content {
      margin: 5% auto;
      width: 95%;
    }

    .create-event-btn {
      width: 100%;
      justify-content: center;
    }
  }

  @media (max-width: 480px) {
    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      flex-direction: column;
      gap: 10px;
    }

    .modal-footer .btn {
      width: 100%;
      min-width: auto;
    }

    form[action*="events_ui"] {
      padding: 15px;
    }

    form[action*="events_ui"] input,
    form[action*="events_ui"] select {
      width: 100%;
      margin-right: 0;
      margin-bottom: 15px;
    }
  }
  .filter-group {
    display: inline-block;
    margin-right: 20px;
    margin-bottom: 15px;
}

.filter-group label {
    display: block;
    color: #ecf0f1;
    font-weight: 600;
    margin-bottom: 5px;
    font-size: 14px;
}

.filter-group input[type="number"],
.filter-group select {
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid #4a5f7a;
    background: #1a2530;
    color: #ecf0f1;
    font-size: 16px;
    width: 120px;
    box-sizing: border-box;
}

.filter-group input[type="number"]:focus,
.filter-group select:focus {
    outline: none;
    border-color: #1abc9c;
    box-shadow: 0 0 0 2px rgba(26, 188, 156, 0.2);
}

.filter-btn {
    padding: 10px 24px;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    vertical-align: bottom;
    height: 42px;
}

.filter-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
}

.clear-filters {
    margin-left: 10px;
    padding: 10px 16px;
    background: #95a5a6;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: inline-block;
    vertical-align: bottom;
    height: 42px;
    line-height: 22px;
}

.clear-filters:hover {
    background: #7f8c8d;
    color: white;
    text-decoration: none;
}

/* Адаптивность */
@media (max-width: 768px) {
    .filter-group {
        display: block;
        margin-right: 0;
        width: 100%;
    }

    .filter-group input[type="number"],
    .filter-group select {
        width: 100%;
    }

    .filter-btn, .clear-filters {
        width: 100%;
        margin: 10px 0 5px 0;
        text-align: center;
    }
}

  </style>
{% endblock %}